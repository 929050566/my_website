![alt text](wallet/image.png)

# 中心化钱包（交易所钱包）
中心化钱包是由集中式第三方拥有和运营的程序，例如允许存储和转移加密货币的中心化交易所, 它对资金拥有独家访问权和控制权。

## 中心化钱包管理私钥的方式
实现一 将私钥做一层DES加密后存数据库，或者waller.data
实现二 使用KMS环境保存加密的私钥
实现三 使用Tee环境.私钥也是加密之后存储在这个环境的数据库文件里面
实现四 使用cloadHSM，或者多节点备份的小型签名机，私钥不会离开设备。需要签名的时候，传入待签名的报文，签名结束之后返回签名报文。发送到区块链网络
其中，一，二，三的安全性不高，容易产生秘钥泄漏。四的安全性高一点，但是最好结合着风控一起搞

## 核心功能点：
批量地址生成
交易所钱包为了性能和快速响应用户，所有交易所钱包都会有一个地址池，地址池里面每次生成成千上万的地址，当用户注册到交易所的时直接给用户分配地址，而不是去生成；当地址池里面的地址少于一定数量时就会去新生成一批。
### 充值
扫链服务扫区块链，解析区块里面的交易数据，当交易数据里面的 to 地址是系统里的用户地址时，就说明有用户充值；整个过程一般会和风控一起联合
![alt text](wallet/image-1.png)
### 提现 
客户将需要提现的金额输入到交易所的业务层，业务层提交给钱包，构造签名参数，经历风控之后，组织待签名交易报文，将交易报文提交给签名机，经过签名后钱包服务组织交易发布到链上。
![alt text](wallet/image-2.png)
### 归集 
把用户地址里面的资金全部归集到一个规整地址里面去，类似于批量转账
### 热转冷
 将归集地址里面的资金转到一个冷钱包
### 冷转热 
从冷钱包将资金转到热钱包，手动操作的过程
### 链路风控 
在整个项目中占据重要的角色，充值，提现，归集，转冷，冷转热中的每一笔交易，业务层和钱包底层都应该建立完善的风控体系

## 常见的中心化钱包
Binance，Okx，Bybit

# 去中心化钱包（HD钱包）
HD钱包允许你从一个主（根）密钥创建海量的子密钥。这意味着，一旦你控制了主密钥，你就可以生成所有的子密钥，主密钥和子密钥形成树状结构。
另外HD钱包不需要任何私钥，就可以从一个父公钥生成所有的子公钥。具体来说，你的主私钥是以纸钱包的方式备份的，并且离线存放在一个安全的地方

## 核心业务
收款
转账
1.用户发起转账
2.获取签名参数
3.本地离线签名
4.发送交易到区块链网路
5.返回交易状态
转账记录 根据地址查询交易记录和根据 Hash 查询
闪兑 一般对接 1inch 或者其他的 aggrator 实现
Dapp 浏览器

## BIP-32 和 BIP-44 标准
HD钱包通常遵循BIP-32（分层确定性钱包的标准）和BIP-44（多币种、多账户结构标准）。BIP-32 定义了如何从一个主密钥派生出子密钥，而BIP-44 则规定了如何在HD钱包中管理多个账户和币种。

![alt text](wallet/image-3.png)
## 助记词
HD钱包通常使用助记词（如12个或24个单词）来表示种子，这些单词用于生成主私钥，并可用于在丢失钱包时恢复所有密钥和资产。

## 常见的去中心化钱包
TP，MetaMask，ImToken

# 硬件钱包
硬件钱包是一种物理技术（有时外形像 U 盘一样），能够在离线，即“冷”的存储空间中，安全地保管加密货币用户的私人加密密钥，以便在日后在线使用，完成某种加密货币交易。
加密货币硬件钱包的运作原理是生成私钥，并为用户提供离线的“冷”物理空间来存储和保管这些私钥。因为它无法接入互联网，黑客除了物理盗取外无法转走你的个人资产。

## 核心业务
地址生成 硬件中集成 BIP，生成助记词和密钥对，使用公钥导出钱包地址
离线签名 组织交易生成 32 位的 Msg Hash, 将签名消息摘要传给硬件，硬件签名之后返回，组织交易发送到区块链网络。

## 常见的硬件钱包
ledger onekey

# 托管MPC钱包
MPC钱包是基于多方计算方法创造的数字加密货币钱包的子工具。 它们允许多个用户创建一个联合钱包来存储数字资产，而不会出现单点故障。

## 什么是MPC技术
基于门限共享秘钥算法，MPC 钱包生成多个私钥分片，当这些分片共同参与 MPC 计算时，便能达到与使用单一私钥时一致的效果。

## 核心业务
地址生成：业务端发出 Keygen 指令，MPC 网络经过多轮共识之后各自产生密钥片，并吐出聚合公钥，业务端使用公钥导出地址。
离线签名：业务端发出 Sign 指令, 并携带待签名的交易报文到 MPC 网络，MPC 网络经过多轮签名成公共，返回签名串给业务端，业务端将交易发送到区块链网络。